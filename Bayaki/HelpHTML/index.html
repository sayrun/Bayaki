<html>
    <head>
        <meta charset="utf-8" />
    </head>
    <body>
        <h1>場所を焼きこむツール</h1>
        <h2>注意事項</h2>
        <p>このソフトウェアは<strong>現状のまま(as is)</strong>提供するソフトウェアでであり、予期せぬ挙動により問題が生じる可能性は否定できず、本ソフトウェアの利用により発生するいかなる事象・問題について保証および補償することはで来ません。</p>
        <p>このソフトウェアは無料で利用することができますが、各位の善意と工夫によってご利用ください。</p>
        <h2>はじめに</h2>
        <p>このツールは、主にGPSで取得した情報とJPEGファイルの時間を比較し、そのJPEGファイルに位置情報を書き込むためのツールです。</p>
        <p>このような機能をもったツールは多くあり、たとえばPicasaやViewNXなどがあります。</p>
        <p>これらのツールと「場所を焼きこむツール」との違いは、GPS Loggerからのデータ取り込みと位置情報の書き込みをセットで行えることにあります。</p>
        <p>たとえば、ViewNXで位置情報を書き込む場合、任意のGPS Loggerで取得したGPXファイルや、Google timelineから取得したKMLを変換したGPXファイルと照合して、対象となるJPEGファイルに位置情報を書き込みます。GPS Loggerからデータを取り込むためにはGPS Babelや付属のソフトを利用して、GPXファイルやnmeaファイルを作成します。つまり、２つ以上のファイルを利用する必要があります。</p>
        <p>これに対して、「場所を焼きこむツール」ではGPS Loggerからの取り込みをプラグインとして持つことで、１つのツールでPGS 情報の取り込みとJPEGファイルへの位置書き込みを行うことができます。</p>
        <p>つまり、あれこれと手間をかけることなく位置情報を書き込むことを目的としたツールが「場所を焼きこむツール」なのです。</p>

        <h2>インストール</h2>
        <p>zipファイルを解凍してできたファイルを任意のフォルダに格納します。</p>
        <h3>zipファイルの内容</h3>
        <ol>
            <li><strong>Bayaki.exe</strong><br />場所を焼きこむツールの実行体。利用時はこのファイルを起動します</li>
            <li><strong>bykIFv1.dll</strong><br />プラグインのためのインターフェイスアセンブリ（Bayaki.exeと同じパスに置きます）</li>
            <li><strong>MapControlLibrary.dll</strong><br />地図表示用のコントロールライブラリ（Bayaki.exeと同じパスに置きます）</li>
            <li><strong>SkyTraqPlugin.dll</strong><br />GT-730FL/SからのGPS取得/設定/消去機能を実装したプラグイン。<br />GT-730FL/Sを対象に作成していますが、[SkyTraq Venus 6 GPS Receiver]のコマンドを使っているので、SkyTraqのチップのGPS Loggerなら対応できるかと思います。<br />A-GPS(Ephemeris)の設定も対応しています。</li>
            <li><strong>GPSBabelPlugin.dll</strong><br />GPS Babelのコンソールプログラムを実行して、その結果を取り込むラッパプラグイン。GPS Balelがインストールされている必要があります。<br />このプラグインを利用することで、ほとんどのGPS Loggerを利用できると思います。</li>
        </ol>
        <h2>起動</h2>
        <p>Bayaki.exeを起動します。</p>
        <p>Bayaki.exeは、データを「マイドキュメント」に「Bayaki Folder」というフォルダを作成して保存します。</p>
        <p><img src="./IMG/image01.png" alt="起動直後の画面" /></p>
        <h2>プラグイン</h2>
        <p>プラグインをインストールする場合、「位置情報元」のタブをクリックして、位置情報元リストに移動します。</p>
        <p><img src="./IMG/image03.png" alt="位置情報元リスト" /></p>
        <p>表示されているツールバーを右クリックして、表示されるコンテキストメニューから「プラグイン追加」を選択します。</p>
        <p><img src="./IMG/image04.png" alt="プラグイン追加" /></p>
        <p>プラグインはDLLファイルの形式です。対応したプラグインの場合、下記のようにアイコンが追加されます。<br />下記の例では[SkyTraqPlugin.dll]と[GPSBabelPlugin.dll]プラグインの両方をインストールしています。</p>
        <p><img src="./IMG/image05.png" alt="プラグインのアイコン" /></p>
        
        <h3>SkytraqPlugin.dll</h3>
        <p><img src="IMG/image06.png" alt="SkyTraqプラグイン" /></p>
        <p>前述したとおり SkyTraq社のVenus6に対応したプラグインです。</p>
        <h4>①設定変更</h4>
        <p>GPS Logを保存する閾値を設定します。</p>
        <p><img src="IMG/image09.png" alt="設定変更画面" /></p>
        <p>「時間」を選択した場合、GPS情報は設定した周期（秒）で記録されます。<br />「距離」を設定した場合、GPS情報は設定した距離（メートル）ごとに記録されます。<br />「速度」は最低記録速度です。</p>

        <h4>②データダウンロード</h4>
        <p>SkyTraqのLogデータを取り込みます。</p>
        <p><img src="./IMG/image10.png" alt="データダウンロード画面"/></p>
        <p>GPS Loggerを接続した状態でポートを選択して「接続」をクリックします。<br />対象ポートは「自動」を選択することで自動で選択されます。</p>
        <p>接続でき場合「ダウンロード」をクリックすることで、データを取り込むことができます。</p>
        <p>※ポートの一覧は画面が表示されるときに取得します。GPS Loggerはこの画面を表示する前に接続してください。</p>

        <h4>③データ消去</h4>
        <p>SkyTraqのLogデータを消去します。</p>
        <p><img src="IMG/image11.png" alt="データ消去"</p>
        <p>GPS Loggerを接続した状態でポートを選択して「消去」をクリックします。<br />対象ポートは「自動」を選択することで自動で選択されます。</p>
        <p>※ポートの一覧は画面が表示されるときに取得します。GPS Loggerはこの画面を表示する前に接続してください。</p>


        <h4>④エフェメリス更新</h4>
        <p>A-GPS(Ephemeris)データをSkyTraqのサーバからダウンロードして、GPS Loggerに設定します。</p>
        <p><img src="./IMG/image12.png" alt="hoga画面" /></p>
        <p>対象のポートを選択して「開始」をクリックしてください。以降は自動でデータをダウンロードしてGPS Loggerに書き込みを行います。</p>
        

        <h3>GPSBabelPlugin.dll</h3>
        <p>GPS Babelのコマンドラインプログラムを実行してデータを取得するプラグインです。このプラグインを利用することで、GPS BabelがサポートするGPS Loggerからデータを取り込むことができます。</p>
        <p><img src="IMG/image13.png" alt="GPSBabel.exeで一時ファイルを作成して取り込むプラグイン（なぜかCONからリダイレクトできない）画面" /></p>
        <p>「GPSBabel.exeのパス」には、GPSBabelのコマンドライン版のパスを指定してください。<br />「起動時のパラメータ」は取り込みを行うためのGPSBabelのパラメータを設定します。</p>
        <h4>起動パラメータについて</h4>
        <p>-oと-Fはプラグイン側で自動に付加するので、設定しないでください。なお、-oは[gps]を指定し、-Fは一時ファイルを指定します。この一時ファイルは取り込み後に削除しています。</p>
        <p>コマンドラインの設定がわからない場合、GPSBabelのGUI版（GPSBabelFE.exe）で取り込みを行い、成功した画面のパラメータをコピーしてください。コピー対象は下記の赤線で囲っている（GPBabelと-o -Fを除く）範囲になります。</p>
        <p><img src="IMG/image17.png" alt="GPSBabelFE" /><br />※画面をキャプチャーしたGPSBabelのバージョンは1.5.3ですが、指定していないパラメータを誤設定するという不具合があって、Set Locationに対応しないGPS Loggerでは取り込みが失敗するという問題があり、上記の画面でも取り込みができていません。現在のリポジトリ(skytraq.cc)を見ると修正されているようですが、対応版はリリースされていません(2016/03/26)。</p>
        <p>余談ですが、このGPS Babelの不具合がこのツールを作成するきっかけになっています。</p>

        <h2>位置情報の取り込み</h2>
        <p>[GPS Import]/[KML Import]/[Skytraq logdata download]/[GPSbabel wrapper]のいずれかからGPSデータを取り込みます。</p>
        <p>取り込みが成功した場合、下記のように一覧に取り込んだデータが追加されます。</p>
        <p><img src="IMG/image14.png" alt="位置情報元画面" /></p>
        <ul>
            <li>開始時間<br />GPSデータの最初の時間です。（GPSデータはUTCで管理していますが、ここではローカル時間で表示します。）</li>
            <li>終了時間<br />GPSデータの最後の時間です。（GPSデータはUTCで管理していますが、ここではローカル時間で表示します。）</li>
            <li>点数<br />位置データの個数です。</li>
            <li>名前<br />任意の名称を設定できます。コンテキストメニューから名称を変更することもできます。</li>
        </ul>
        <h3>google map timelineの利用</h3>
        <p>Google Map Timelineは、スマフォなどの位置情報を記録する機能ですが、このデータをKML ファイルとしてダウンロードすることできます。GPS Loggerを持っていない場合、このKMLを位置情報元として利用することもできます。また、GPS Loggerを持っている場合でもKMLと併用することで、GPS Loggerにないデータを補完できる場合があります。</p>
        <p><img src="IMG/image18.png" alt="Google map timeline KML export" width="80%" height="80%" /></p>
        <h3>道順表示</h3>
        <p>位置情報元のリストのコンテキストメニューから「道順表示」を選択すると、経路情報として地図表示から確認することができます。</p>
        <p><img src="IMG/image15.png" alt="コンテキストメニュー" /></p>
        <p><img src="IMG/image16.png" alt="道順表示" /></p>
        <p>記録開始と終了、Waypoint（POI）については、マーカーを表示します。マーカーにカーソルを重ねると時間と位置情報を確認できます。</p>

        <h2>JPEGファイルへの位置設定</h2>
        <p>位置情報を取り込んだら、位置情報を設定したいJPEGファイルを「JPEGファイルをここにドロップしてください」と表示されている領域にドロップしてください。</p>
        <p>ドロップしたファイルがサムネイル表示されます。</p>
        <p><img src="IMG/image02.png" alt="サムネイル表示" /></p>
        <p>対象のサムネイルを選択するとプレビュー表示と、位置情報に従った地図表示を行います。</p>
        <h3>サムネイルの文字色</h3>
        <p>サムネルは位置情報の状況によって色が変わります。</p>
        <ol>
            <li>黒（チェックあり）<br />位置情報元に同じ時間がありました。</li>
            <li>黒（チェックなし）<br />位置情報元に撮影時間のデータがない状態です（更新対象ではありません）。</li>
            <li>ピンク<br />位置情報元に撮影時間と同じ時間のデータがない状態で、近い時間の位置情報を設定しました。</li>
            <li>青<br />位置情報元に撮影時間のデータがない状態ですが、元のファイルに位置情報がありました。</li>
        </ol>
        <h3>チェックボックス</h3>
        <p>更新すべき状態である場合には自動でチェックされますが、ユーザ操作で保存対象から外すことができます。</p>
        <p>なお、青で表示されているJPEGファイルにチェックを入れた場合、位置情報の削除と同じ動作になります。</p>
        <h3>位置情報の更新</h3>
        <p>プレビュー表示エリアを右クリックして表示されるコンテキストメニューから、位置情報の削除と新規追加を行うことができます。</p>
        <p>また、地図のプレビュー画面でマーカーをドラッグすることで位置情報を調整することができます。</p>
        <h3>JPEGファイルの更新</h3>
        <p>「保存更新」をクリックすると、チェックボックスがチェックされているJPEGファイルを位置情報を更新します。</p>
    </body>
</html>